import{Q as pe,a as me}from"./QInnerLoading-DfrxAtBn.js";import{d as X,t as ce,b as s,c as S,w as fe,B as ve,o as ge,v as a,a7 as be,p as $,at as q,I as o,a8 as B,af as x,a0 as p,u as n,aa as L,Q as w,au as j,a9 as m,ak as Y,al as Z,y as f,T as _e,x as v,ae as ye,a6 as M,a as we,av as Ce,W as Ve,F as G}from"./index-Du_3Vesk.js";import"./axios-CInKXjoT.js";import"./auth-dzuJufgy.js";import{u as ke}from"./apps-B1o9GbeE.js";import{_ as Qe}from"./RecursiveComponent.vue_vue_type_script_setup_true_lang-CQmSpjAA.js";import{Q as xe}from"./QItemLabel-CcbGqN9l.js";import{Q as H}from"./QItemSection-CpQhvstY.js";import{Q as Se}from"./QItem-DtTTb-ec.js";import{Q as c}from"./QTooltip-CsZJC6ig.js";import{b as Ie,Q as De,a as O}from"./QTable-BfwWHyg7.js";import{Q as he}from"./QSpace-k_Ok6dG2.js";import{_ as Ee,Q as J}from"./CopyDownloadData.vue_vue_type_script_setup_true_lang-BEd0puie.js";import{d as Re}from"./utils-BH9nH3nv.js";import{a as W}from"./api-C-PlNVV_.js";import{_ as Te}from"./IfAccess.vue_vue_type_script_setup_true_lang-DM6OWTUi.js";import{u as Ue}from"./remote_app-C7FrUm08.js";import"./index-3fevySbJ.js";import"./pinia-BXXl-SmG.js";import"./marked.esm-CrmhQBcZ.js";import"./websocket-Cgz6NUB5.js";import"./jsoneditor.min-DkeLFdXe.js";import"./use-quasar-IjjsIl5B.js";import"./QResizeObserver-BmVOFGfH.js";import"./selection-BDLl0KOp.js";import"./QList-C_17cm5H.js";import"./QChip-H_55yLGh.js";import"./format-CJebrXOQ.js";const Ae=X({__name:"DebugAppComponent",props:{events:{},clearEvents:{type:Function}},setup(z){const E=z,{events:C,clearEvents:R}=ce(E),V=s(!0),I=s(!0),g=s(""),i=s(""),b=s(""),D=s(!0),k=s(!0),Q=s(!1),u=S(()=>{const e=C.value.map(t=>t.component_type);return Array.from(new Set(e))}),r=s([]),_=["QTooltip","Label","Heading","Centered","Row","Col","Div"],y=()=>{const e=new Set(r.value),t=u.value.filter(d=>e.has(d)),l=u.value.filter(d=>!e.has(d));t.length===u.value.length?r.value=[]:r.value=l},ee=()=>{r.value=[]},te=()=>{r.value=u.value},oe=(e,t)=>{r.value=[t.component_type],e.shiftKey&&y()},le=S(()=>{let e=C.value;return r.value.length>0&&(e=e.filter(t=>r.value.includes(t.component_type))),g.value&&(e=e.filter(t=>(t.component_id.toLowerCase()||t.component_index.toString()).includes(g.value.toLowerCase()))),i.value&&(e=e.filter(t=>t.component_type.toLowerCase().includes(i.value.toLowerCase()))),b.value&&(e=e.filter(t=>{const l=t.props||t.slots;return Object.keys(l).length==1?Object.keys(l)[0].toLowerCase().includes(b.value.toLowerCase()):!1})),D.value||(e=e.filter(t=>t.source!="frontend")),k.value||(e=e.filter(t=>t.source!="backend")),Q.value&&(e=e.filter(t=>!_.includes(t.component_type))),e}),ae=e=>{const t={};return e.slots&&(t.slots=e.slots),e.props&&(t.props=e.props),e.data&&(t.data=e.data),JSON.stringify(t,null,2)},F=e=>{if(e.slots&&e.props||e.data)return"[...]";if(!e.slots&&!e.props)return"";const t=e.props||e.slots;if(Object.keys(t).length==1){const l=Object.values(t)[0];return typeof l=="object"?"[...]":l}return"[...]"},ne=[{label:"Time",field:"timestamp",name:"timestamp",sortable:!0},{label:"Source",field:e=>e.source=="frontend"?"mdi-browser":"mdi-server",name:"source",sortable:!0},{label:"Type",field:"component_type",name:"type",sortable:!0},{label:"Id",field:"component_id",field:e=>e.component_id?e.component_id.split(".").slice(-1):e.component_index,name:"id",sortable:!0},{label:"Key",field:e=>{if(e.slots&&e.props)return"...";if(e.data)return"data";if(!e.slots&&!e.props)return"";const t=e.props||e.slots;if(Object.keys(t).length==1)return Object.keys(t)[0]},name:"type",sortable:!0},{label:"Value",field:F,name:"value",sortable:!0}],se=e=>{console.log("setCaptureEvents",e),python.setDebugging({capture_events:e})},re=e=>{console.log("setCaptureStack",e),python.setDebugging({capture_call_stack:e})},ue=async()=>{var d,U;const e=await python.createTestingData(),t=(d=e.filename)!=null?d:"Untitled",l=(U=e.type)!=null?U:"application/zip";Re({filename:t,data:e.data,type:l})},P=s(""),N=s(""),K=async()=>{const e=await W.get(`/job/last_of_file/${T.value}`);P.value=e.stdout,N.value=e.stderr};fe(u,e=>{r.value=e},{immediate:!0});const T=S(()=>parseInt(q.currentRoute.value.query.id)),h=s({}),A=s({}),de=async()=>{if(!T.value){A.value="",h.value={};return}try{const e=await W.get(`/model/${T.value}`);h.value=e.data,A.value=h.value.metadata.name}catch(e){console.error("Failed to fetch data:",e),h.value={}}};return ve(()=>{}),(e,t)=>($(),ge(be,{flat:""},{default:a(()=>[o(B,{class:"row"},{default:a(()=>[o(x,{label:"Capture Events",modelValue:n(V),"onUpdate:modelValue":[t[0]||(t[0]=l=>p(V)?V.value=l:null),se]},null,8,["modelValue"]),o(x,{label:"Capture call stack",modelValue:n(I),"onUpdate:modelValue":[t[1]||(t[1]=l=>p(I)?I.value=l:null),re]},null,8,["modelValue"]),o(x,{label:"Frontend",modelValue:n(D),"onUpdate:modelValue":t[2]||(t[2]=l=>p(D)?D.value=l:null)},null,8,["modelValue"]),o(x,{label:"Backend",modelValue:n(k),"onUpdate:modelValue":t[3]||(t[3]=l=>p(k)?k.value=l:null)},null,8,["modelValue"]),o(L,{label:"Component type",modelValue:n(i),"onUpdate:modelValue":t[4]||(t[4]=l=>p(i)?i.value=l:null),class:"q-mx-md"},null,8,["modelValue"]),o(L,{label:"Component ID",modelValue:n(g),"onUpdate:modelValue":t[5]||(t[5]=l=>p(g)?g.value=l:null),class:"q-mx-md"},null,8,["modelValue"]),o(L,{label:"Key",modelValue:n(b),"onUpdate:modelValue":t[6]||(t[6]=l=>p(b)?b.value=l:null),class:"q-mx-md"},null,8,["modelValue"]),o(Ie,{"hide-bottom-space":"","options-dense":"","hide-dropdown-icon":"","use-input":"",dense:"","hide-selected":"",filled:"",modelValue:n(r),"onUpdate:modelValue":t[8]||(t[8]=l=>p(r)?r.value=l:null),options:n(u),label:"Components",multiple:"",style:{"margin-top":"15px"}},{option:a(({itemProps:l,opt:d,selected:U,toggleOption:ie})=>[o(Se,Y(Z(l)),{default:a(()=>[o(H,null,{default:a(()=>[o(xe,null,{default:a(()=>[m(f(d),1)]),_:2},1024)]),_:2},1024),o(H,{side:""},{default:a(()=>[o(x,{"model-value":U,"onUpdate:modelValue":$e=>ie(d)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),append:a(()=>[o(w,{dense:"",flat:"",icon:"mdi-toggle-switch",onClick:j(y,["stop"])},{default:a(()=>[o(c,null,{default:a(()=>t[9]||(t[9]=[m(" Toggle selected")])),_:1})]),_:1}),o(w,{dense:"",flat:"",icon:"mdi-select-all",onClick:j(te,["stop"])},{default:a(()=>[o(c,null,{default:a(()=>t[10]||(t[10]=[m(" Select all")])),_:1})]),_:1}),o(w,{dense:"",flat:"",icon:"mdi-delete",onClick:j(ee,["stop"])},{default:a(()=>[o(c,null,{default:a(()=>t[11]||(t[11]=[m(" Clear components")])),_:1})]),_:1}),o(x,{dense:"",modelValue:n(Q),"onUpdate:modelValue":t[7]||(t[7]=l=>p(Q)?Q.value=l:null)},{default:a(()=>[o(c,null,{default:a(()=>t[12]||(t[12]=[m(" Show interactive ")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","options"]),o(he),o(Ee,{data:n(h),filename:n(A),fileId:n(T)},null,8,["data","filename","fileId"]),o(w,{icon:"mdi-download",flat:"",onClick:ue},{default:a(()=>[o(c,null,{default:a(()=>t[13]||(t[13]=[m(" Download testing data")])),_:1})]),_:1}),o(w,{icon:"mdi-reload",flat:"",onClick:de},{default:a(()=>[o(c,null,{default:a(()=>t[14]||(t[14]=[m(" Reload app data")])),_:1})]),_:1}),o(w,{icon:"mdi-delete",flat:"",color:"negative",size:"lg",onClick:n(R)},null,8,["onClick"])]),_:1}),o(B,{class:"text-h5 row"},{default:a(()=>[o(De,{class:"col-auto",flat:"",rows:n(le),pagination:{rowsPerPage:50},columns:ne,"wrap-cells":"",style:{height:"500px"},onRowDblclick:oe},{"body-cell-timestamp":a(({row:l})=>[o(O,{class:"text-center"},{default:a(()=>[m(f((l.timestamp-n(C).at(-1).timestamp).toFixed(3)),1)]),_:2},1024)]),"body-cell-value":a(l=>[o(O,{props:l},{default:a(()=>[m(f(F(l.row))+" ",1),o(c,{anchor:"top middle",self:"bottom middle"},{default:a(()=>[v("pre",null,f(ae(l.row)),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-source":a(l=>[o(O,{props:l},{default:a(()=>[o(_e,{size:"sm",name:l.row.source=="frontend"?"mdi-monitor":"mdi-server-outline"},null,8,["name"]),o(c,{anchor:"top middle",self:"bottom middle"},{default:a(()=>[v("pre",null,f(l.row.stack_trace),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),o(B,null,{default:a(()=>[o(J,{label:"Stdout","expand-separator":"",onBeforeShow:K},{default:a(()=>[v("pre",null,f(n(P)),1)]),_:1}),o(J,{label:"Stderr","expand-separator":"",onBeforeShow:K},{default:a(()=>[v("pre",null,f(n(N)),1)]),_:1})]),_:1})]),_:1}))}}),Be={class:"row"},Le={key:0,class:"col-6"},je={class:"fixed-center"},Oe={style:{"text-align":"center","padding-top":"130px"}},ft=X({__name:"AppPage",setup(z){const E=Ue();G("remoteApp",E);const C=ke(),R=S(()=>parseInt(q.currentRoute.value.query.appId));S(()=>parseInt(q.currentRoute.value.query.id)),s(null);const V=s({compId:null}),I=s(!1),g=s("Loading..."),i=s([]),b=()=>{i.value=[]};G("traceEvent",_=>{i.value.unshift(_)});const k=async()=>{await C.load();const _=Ve(C.apps[R.value]);console.log("app_data",_);const y=await E.loadApp(_);console.log("got app data",y),y&&(V.value=y)},Q=S(()=>u.value?"col-6":"col-12"),u=s(!1),r=()=>{u.value=!u.value};return ye(k),(_,y)=>($(),M("div",Be,[v("div",{class:Ce(n(Q))},[o(Qe,Y(Z(n(V))),null,16)],2),n(u)?($(),M("div",Le,[o(Ae,{events:n(i),clearEvents:b},null,8,["events"])])):we("",!0),o(n(me),{showing:n(I)},{default:a(()=>[v("div",null,[v("div",je,[o(pe,{size:"100px",color:"primary"})]),v("div",Oe,f(n(g)),1)])]),_:1},8,["showing"]),o(Te,{app:n(R),admin:""},{default:a(()=>[o(w,{fab:"",icon:"mdi-bug-outline",class:"fixed-bottom-left",onClick:r})]),_:1},8,["app"])]))}});export{ft as default};
