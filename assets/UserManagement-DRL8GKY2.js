import{Q as j}from"./QSpace-k_Ok6dG2.js";import{d as T,t as G,b as r,c as L,o as H,v as s,a0 as y,u as o,a$ as K,p as f,I as e,a8 as k,a9 as C,aa as E,Q as I,a7 as z,w as W,y as Q,x as u,a6 as _,ad as D,ab as F,aO as X,ae as Z,af as M,ac as J,a as h}from"./index-Du_3Vesk.js";import{c as Y,b as ee,Q as le,a as O}from"./QTable-BfwWHyg7.js";import{_ as R}from"./ButtonWithTooltip.vue_vue_type_script_setup_true_lang-GHMn38hu.js";import{_ as ae}from"./DateComponent.vue_vue_type_script_setup_true_lang-D3xsPFaU.js";import{Q as te}from"./QForm-DvVOEjuU.js";import{a as g}from"./api-C-PlNVV_.js";import{c as se}from"./utils-BH9nH3nv.js";import"./QList-C_17cm5H.js";import"./QChip-H_55yLGh.js";import"./QItem-DtTTb-ec.js";import"./QItemSection-CpQhvstY.js";import"./QItemLabel-CcbGqN9l.js";import"./QTooltip-CsZJC6ig.js";import"./selection-BDLl0KOp.js";import"./format-CJebrXOQ.js";import"./i18n-CfPL3nQe.js";import"./index-3fevySbJ.js";import"./axios-CInKXjoT.js";import"./auth-dzuJufgy.js";import"./pinia-BXXl-SmG.js";const oe=T({__name:"CreateUser",props:{modelValue:{type:Boolean}},emits:["update:modelValue","create"],setup(S,{emit:P}){const w=P,$=S,{modelValue:q}=G($),m=r(!0),p=r(""),V=r(""),b=r(""),N=[i=>!!i||"Username is required",i=>i&&i.length>=4||"Username must be at least 4 characters"],d=r(""),B=[i=>!!i||"E-mail is required",i=>/.+@.+\..+/.test(i)||"E-mail must be valid"],A=r(""),x=r(""),v=[i=>!!i||"Password is required",i=>i&&i.length>=4||"Password must be at least 4 characters"],l=L({get(){return q.value},set(i){w("update:modelValue",i)}}),t=r(null),a=()=>{t.value.reset()},U=async()=>{await t.value.validate();const i={email:d.value,username:p.value,firstName:V.value,lastName:b.value,password:A.value,admin_password:x.value};l.value=!1,await g.put("admin/user",i),w("create")};return(i,n)=>(f(),H(K,{modelValue:o(l),"onUpdate:modelValue":n[8]||(n[8]=c=>y(l)?l.value=c:null)},{default:s(()=>[e(z,null,{default:s(()=>[e(k,null,{default:s(()=>n[9]||(n[9]=[C(" Create User ")])),_:1}),e(k,null,{default:s(()=>[e(te,{ref_key:"userForm",ref:t,modelValue:o(m),"onUpdate:modelValue":n[7]||(n[7]=c=>y(m)?m.value=c:null),"lazy-validation":""},{default:s(()=>[e(E,{modelValue:o(p),"onUpdate:modelValue":n[0]||(n[0]=c=>y(p)?p.value=c:null),rules:N,label:"User name",required:""},null,8,["modelValue"]),e(E,{modelValue:o(V),"onUpdate:modelValue":n[1]||(n[1]=c=>y(V)?V.value=c:null),label:"First name",required:""},null,8,["modelValue"]),e(E,{modelValue:o(b),"onUpdate:modelValue":n[2]||(n[2]=c=>y(b)?b.value=c:null),label:"Last name",required:""},null,8,["modelValue"]),e(E,{modelValue:o(d),"onUpdate:modelValue":n[3]||(n[3]=c=>y(d)?d.value=c:null),rules:B,label:"E-mail",required:""},null,8,["modelValue"]),e(E,{modelValue:o(A),"onUpdate:modelValue":n[4]||(n[4]=c=>y(A)?A.value=c:null),rules:v,label:"New user password",type:"password",required:""},null,8,["modelValue"]),e(E,{modelValue:o(x),"onUpdate:modelValue":n[5]||(n[5]=c=>y(x)?x.value=c:null),rules:v,label:"Your password",type:"password",required:""},null,8,["modelValue"]),e(I,{disabled:!o(m),color:"positive",class:"mr-4",onClick:U},{default:s(()=>n[10]||(n[10]=[C(" Create ")])),_:1},8,["disabled"]),e(I,{color:"negative",class:"mr-4",onClick:a},{default:s(()=>n[11]||(n[11]=[C(" Reset Form ")])),_:1}),e(I,{color:"warning",onClick:n[6]||(n[6]=c=>l.value=!1)},{default:s(()=>n[12]||(n[12]=[C(" Cancel ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ne=T({__name:"EditUser",props:{modelValue:{type:Boolean},userId:{}},emits:["update:modelValue","change"],setup(S,{emit:P}){const w=P,$=S,{modelValue:q,userId:m}=G($),p=r({}),V=r([]),b=r([]),N=r(0),d=L({get(){return q.value},set(v){w("update:modelValue",v)}}),B=L(()=>m.value&&q.value);W(()=>B.value,async()=>{m.value===void 0||!d.value||(p.value=(await g.get(`/admin/user/${m.value}`)).data,V.value=(await g.get(`/admin/user/${m.value}/app_access`)).data,b.value=[{label:"Default",value:null}].concat((await g.get("/admin/access_levels")).data),N.value=se(V.value))});const A=async()=>{const v=N.value,l=V.value,t=[];for(let a=0;a<v.length;a++)l[a].access_level!==v[a].access_level&&t.push(g.post(`/admin/user/${m.value}/app_access`,{app_id:v[a].app.id,access_level:l[a].access_level}));await Promise.all(t),d.value=!1},x=async()=>{await g.admin.promptPassword(`Delete User ${p.value.name}`).onOk(async v=>{d.value=!1,typeof v=="string"&&(await g.post(`/admin/user/${m.value}/delete`,{password:v}),w("change"))})};return(v,l)=>(f(),H(K,{modelValue:o(d),"onUpdate:modelValue":l[1]||(l[1]=t=>y(d)?d.value=t:null)},{default:s(()=>[e(z,null,{default:s(()=>[e(k,{class:"text-h6"},{default:s(()=>[C(" Edit User "+Q(o(p).name),1)]),_:1}),e(k,null,{default:s(()=>[e(Y,null,{default:s(()=>[l[5]||(l[5]=u("thead",null,null,-1)),u("tbody",null,[u("tr",null,[l[2]||(l[2]=u("td",null,"Username",-1)),u("td",null,Q(o(p).name),1)]),u("tr",null,[l[3]||(l[3]=u("td",null,"Id",-1)),u("td",null,Q(o(p).id),1)]),u("tr",null,[l[4]||(l[4]=u("td",null,"Admin",-1)),u("td",null,Q(o(p).is_admin),1)])])]),_:1})]),_:1}),e(k,{class:"text-h6"},{default:s(()=>l[6]||(l[6]=[C(" App Access ")])),_:1}),e(k,null,{default:s(()=>[e(Y,null,{default:s(()=>[l[7]||(l[7]=u("thead",null,[u("tr",null,[u("td",null,"App"),u("td",null,"Access Level")])],-1)),u("tbody",null,[(f(!0),_(F,null,D(o(V),t=>(f(),_("tr",{key:t.app.id},[u("td",null,Q(t.app.name),1),u("td",null,[e(ee,{modelValue:t.access_level,"onUpdate:modelValue":a=>t.access_level=a,options:o(b),"emit-value":"","map-options":"",dense:""},null,8,["modelValue","onUpdate:modelValue","options"])])]))),128))])]),_:1})]),_:1}),e(X,{class:"q-ma-sm"},{default:s(()=>[e(I,{color:"negative",class:"mr-4",onClick:x},{default:s(()=>l[8]||(l[8]=[C(" Delete ")])),_:1}),e(j),e(I,{color:"warning",onClick:l[0]||(l[0]=t=>d.value=!1)},{default:s(()=>l[9]||(l[9]=[C(" Cancel ")])),_:1}),e(I,{color:"positive",onClick:A},{default:s(()=>l[10]||(l[10]=[C(" Save ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ue={class:"row",dense:""},de={class:"row"},re={class:"col"},ie={key:0},Ee=T({__name:"UserManagement",setup(S){const P=l=>{const t={...l};return t.picture=null,JSON.stringify(t,null,2)},w=r(!1),$=r(!1),q=r(""),m=r([]),p=r([]),V=r([]),b=r({}),N=[{label:"Name",name:"name",field:"name",align:"left",sortable:!0},{label:"Last Login",name:"last_login",field:"last_login",align:"left",sortable:!0},{label:"App dev",name:"is_app_developer",fname:"is_app_developer",align:"center",sortable:!0},{label:"Admin",name:"admin",field:"admin",align:"center",sortable:!0},{label:"Actions",name:"actions",field:"actions",align:"center"}],d=async()=>{const l=(await g.get("/admin/get_app_access")).data;m.value=l.users,p.value=l.apps,V.value=l.levels,b.value=l.access};Z(d);const B=l=>{q.value=l,$.value=!0},A=async()=>{g.admin.promptPassword("Import users from keycloak database").onOk(async l=>{await g.post("/admin/import_users",{password:l}),await d()})},x=async(l,{id:t})=>{await g.post(`/admin/user/${t}/set_admin`,{is_admin:l}),await d()},v=async(l,{id:t})=>{await g.post(`/admin/user/${t}/set_app_developer`,{is_app_developer:l}),await d()};return(l,t)=>(f(),_("div",null,[e(z,{flat:"",class:"q-ma-md"},{default:s(()=>[e(k,{class:"text-h6 row"},{default:s(()=>[t[3]||(t[3]=u("div",null,"Users",-1)),e(j),e(R,{tooltip:"Add User","icon-size":"large",icon:"mdi-account-plus",size:"large",onClick:t[0]||(t[0]=a=>w.value=!o(w))}),e(R,{icon:"mdi-database-import",tooltip:"Import from Database","icon-size":"large",size:"large",color:"warning",onClick:A})]),_:1}),e(k,null,{default:s(()=>[e(le,{flat:"",rows:o(m),columns:N,pagination:{rowsPerPage:10},"hide-bottom":o(m).length<=10},{"body-cell-last_login":s(({row:a})=>[e(O,null,{default:s(()=>[e(ae,{date:a.last_login},null,8,["date"])]),_:2},1024)]),"body-cell-is_app_developer":s(({row:a})=>[e(O,{class:"text-center"},{default:s(()=>[e(M,{"model-value":a.is_app_developer,"onUpdate:modelValue":U=>v(U,a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),"body-cell-admin":s(({row:a})=>[e(O,{class:"text-center"},{default:s(()=>[e(M,{"model-value":a.is_admin,"onUpdate:modelValue":U=>x(U,a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),"body-cell-actions":s(({row:a})=>[e(O,{class:"text-center"},{default:s(()=>[e(R,{tooltip:"Edit",icon:"mdi-account-edit",onClick:U=>B(a.id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","hide-bottom"])]),_:1})]),_:1}),e(z,{flat:"",class:"q-ma-md"},{default:s(()=>[e(k,{class:"text-h6 row"},{default:s(()=>t[4]||(t[4]=[C("App access")])),_:1}),e(k,null,{default:s(()=>[u("div",ue,[t[5]||(t[5]=u("div",{class:"col"},null,-1)),(f(!0),_(F,null,D(o(p),a=>(f(),_("div",{class:"col",key:a.id+"_header"},Q(a.name),1))),128))]),e(J),(f(!0),_(F,null,D(o(m),a=>(f(),_("div",{key:a.id,dense:""},[u("div",de,[u("div",re,[e(R,{icon:"mdi-account-edit",tooltip:"edit",onClick:U=>B(a.id)},null,8,["onClick"]),C(" "+Q(a.name+(a.is_admin?" (admin)":"")),1)]),(f(!0),_(F,null,D(o(p),U=>(f(),_("div",{class:"col",key:U.id},[o(b)[a.id+"_"+U.id]?(f(),_("div",ie,Q(o(V)[o(b)[a.id+"_"+U.id].access_level_v]),1)):h("",!0)]))),128))]),e(J)]))),128))]),_:1})]),_:1}),e(oe,{modelValue:o(w),"onUpdate:modelValue":t[1]||(t[1]=a=>y(w)?w.value=a:null),onCreate:d},null,8,["modelValue"]),e(ne,{modelValue:o($),"onUpdate:modelValue":t[2]||(t[2]=a=>y($)?$.value=a:null),"user-id":o(q),onChange:d},null,8,["modelValue","user-id"]),(f(!0),_(F,null,D(o(p),a=>(f(),_("div",{key:a.id},[u("pre",null," "+Q(P(a))+" ",1)]))),128))]))}});export{Ee as default};
