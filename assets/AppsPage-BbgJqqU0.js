import{Q as D}from"./QSpace-k_Ok6dG2.js";import{Q as L}from"./QItemLabel-CcbGqN9l.js";import{Q as H}from"./QItemSection-CpQhvstY.js";import{Q as Y}from"./QItem-DtTTb-ec.js";import{Q as O}from"./QTooltip-CsZJC6ig.js";import{d as R,t as F,c as E,o as u,a as n,u as r,p as l,T as z,v as o,I as a,a9 as d,y as p,b as S,w as G,ae as J,x as _,a6 as v,ab as K,ad as W,a7 as X,a8 as $,au as w,at as I,aO as Z,Q as N,Y as y}from"./index-Du_3Vesk.js";import{Q as k}from"./QImg-wSeLu4do.js";import{Q as ee}from"./QPage-djjMHNky.js";import{api as T}from"./axios-CInKXjoT.js";import{V as te,T as h,S as se,u as oe,A as B}from"./apps-B1o9GbeE.js";import{u as ae}from"./user-Q-Yu3pSj.js";import{_ as V}from"./IfAccess.vue_vue_type_script_setup_true_lang-DM6OWTUi.js";import{_ as M}from"./ButtonWithTooltip.vue_vue_type_script_setup_true_lang-GHMn38hu.js";import{_ as re}from"./DateComponent.vue_vue_type_script_setup_true_lang-D3xsPFaU.js";import{b as le}from"./utils-BH9nH3nv.js";import"./selection-BDLl0KOp.js";import"./index-3fevySbJ.js";import"./auth-dzuJufgy.js";import"./pinia-BXXl-SmG.js";import"./marked.esm-CrmhQBcZ.js";import"./websocket-Cgz6NUB5.js";import"./api-C-PlNVV_.js";import"./i18n-CfPL3nQe.js";const ne=R({__name:"AccessLevelIcon",props:{accessLevel:{}},setup(A){const f=A,{accessLevel:m}=F(f),i={};i[te]={icon:"lock",color:"grey",tooltip:"No Access"},i[h]={icon:"schedule",color:"blue",tooltip:"Trial Access"},i[se]={icon:"mdi-check-circle",color:"green",tooltip:"Standard Access"};const c=E(()=>i[m.value]);return(x,q)=>r(c)?(l(),u(z,{key:0,name:r(c).icon,color:r(c).color,size:"lg"},{default:o(()=>[a(O,null,{default:o(()=>[d(p(r(c).tooltip),1)]),_:1})]),_:1},8,["name","color"])):n("",!0)}}),ie={class:"row"},ce={class:"col"},ue={class:"text-grey text-subtitle2 row no-margin no-padding"},de={key:0,class:"text-grey text-subtitle2 row no-margin no-padding"},me=["innerHTML"],pe={key:0,class:"q-pr-md"},Me=R({__name:"AppsPage",setup(A){const f=ae(),m=oe(),i=S([]),c=S({}),x=t=>{const s=new Date(0);return s.setDate(s.getDate()+t),s},q=t=>x(t)>new Date?"Expires on":"Expired on",Q=t=>E(()=>(m==null?void 0:m.apps[t].access_level)>=h);G(()=>m.apps,async t=>{if(t!=null){i.value=Object.values(t);for(const s of i.value)await b(s.owner)}}),J(async()=>{await m.load(),i.value=Object.values(m.apps);for(const t of i.value)await b(t.owner)});const P=async t=>{Q(t.id).value?I.push({path:"/app",query:{appId:t.id}}):C(t)},C=async t=>{y.create({title:"Request trial access",message:`Do you want to request trial access to ${t.name}?`,cancel:!0}).onOk(async()=>{await U(t)})},U=async t=>{const e=(await T.post("/request_trial_access",{app_id:t.id})).data;e.request==="success"?y.create({message:e.message,color:"positive"}):e.request==="already_requested"?y.create({message:"You have already requested trial access to this app.",color:"warning"}):y.create({message:"Error requesting trial access.",color:"negative"})},b=async t=>{if(!t||!f.isAdmin)return"";if(c.value[t])return c.value[t];const s=await T.get(`/app_admin/user/${t}/name`);return c.value[t]=s.data,s.data},j=t=>{window.location.href=t};return(t,s)=>(l(),u(ee,null,{default:o(()=>[_("div",ie,[(l(!0),v(K,null,W(r(i),e=>(l(),v("div",{class:"q-pa-sm col-md-4 col-sm-6 col-xs-12",key:e.name},[a(X,{class:"fit q-pa-sm hover-highlight",onClick:g=>P(e),style:{cursor:"pointer",display:"flex","flex-direction":"column"}},{default:o(()=>[a($,{class:"text-h6 row",style:{flex:"1 1 auto"}},{default:o(()=>[_("div",ce,[d(p(e.name)+" ",1),a(V,{app:e.id,admin:""},{default:o(()=>[_("span",ue,[d(" Version: "+p(e.version)+" ",1),s[0]||(s[0]=_("br",null,null,-1)),s[1]||(s[1]=d(" Updated: ")),a(re,{date:e.last_updated},null,8,["date"]),s[2]||(s[2]=d()),s[3]||(s[3]=_("br",null,null,-1)),d(" "+p(r(c)[e.owner]?"Owner: "+r(c)[e.owner]:""),1)])]),_:2},1032,["app"]),e.owner==r(f).id&&!r(f).isAdmin?(l(),v("span",de," App Owner ")):n("",!0)]),a(D),e.access_level===r(h)?(l(),u(Y,{key:0,class:"text-subtitle2"},{default:o(()=>[a(H,null,{default:o(()=>[a(L,null,{default:o(()=>[d(p(q(e.expiry_date)),1)]),_:2},1024),a(L,{caption:""},{default:o(()=>[d(p(x(e.expiry_date).toDateString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):n("",!0),e.access_level===r(B)?(l(),u(M,{key:1,size:"xl",color:"primary",icon:"settings",class:"q-pa-none q-pb-sm",tooltip:"App management",onClick:w(g=>r(I).push({path:"/admin/app",query:{appId:e.id}}),["stop"])},null,8,["onClick"])):n("",!0),r(f).isAppDeveloper&&e.access_level==r(B)?(l(),u(M,{key:2,size:"xl",icon:"mdi-dev-to",class:"q-pa-none q-pb-sm",tooltip:"Create dev command to serve this app",color:"accent",onClick:w(g=>r(le)(e),["stop"])},null,8,["onClick"])):n("",!0),a(ne,{accessLevel:e.access_level},null,8,["accessLevel"]),e.is_public?(l(),u(V,{key:3,app:e.id,admin:""},{default:o(()=>[a(z,{size:"xl",color:"positive",name:"public",class:"text-primary"},{default:o(()=>[a(O,null,{default:o(()=>s[4]||(s[4]=[d("Public")])),_:1})]),_:1})]),_:2},1032,["app"])):n("",!0)]),_:2},1024),a($,{class:"col"},{default:o(()=>[e.image?(l(),u(k,{key:0,"no-spinner":"",src:e.image,fit:"scale-down",height:"200px",position:"0 0",style:{"max-width":"40%",float:"right",margin:"0 0 0 0px"}},null,8,["src"])):n("",!0),_("div",{innerHTML:e.text,style:{width:"100%"}},null,8,me)]),_:2},1024),a(Z,null,{default:o(()=>[e.logo.text?(l(),v("span",pe,p(e.logo.text),1)):n("",!0),e.logo.image&&e.logo.link?(l(),u(N,{key:1,flat:"",dense:"",position:"0 100%",onClick:g=>j(e.logo.link)},{default:o(()=>[a(k,{position:"left",src:e.logo.image,fit:"scale-down",height:"60px",width:"130px"},null,8,["src"])]),_:2},1032,["onClick"])):n("",!0),e.logo.image&&!e.logo.link?(l(),u(k,{key:2,position:"left",src:e.logo.image,fit:"scale-down",height:"60px",width:"130px"},null,8,["src"])):n("",!0),a(D),Q(e.id).value?n("",!0):(l(),u(N,{key:3,color:"primary",onClick:w(g=>C(e),["stop"])},{default:o(()=>s[5]||(s[5]=[d(" Request trial access ")])),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:1}))}});export{Me as default};
