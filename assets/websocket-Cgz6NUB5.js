import{d as h}from"./pinia-BXXl-SmG.js";import{u as _,C as k}from"./auth-dzuJufgy.js";import{p as u,o as f,i as E,n as L,w as S}from"./utils-BH9nH3nv.js";import{b as r,w as b}from"./index-Du_3Vesk.js";const I=h("websocket",()=>{const c=_(),t={reconnect:[]},s=r(null),a=r(!1),o=r(null),p=n=>{const e=JSON.parse(n.data);if(e.type in t)for(const y of t[e.type])y(e);e.type==="message"&&(e.message_type==="info"&&E(e.message,e.options||{}),e.message_type==="ongoing"&&f(e.message,e.options||{}),e.message_type==="positive"&&u(e.message,e.options||{}),e.message_type==="negative"&&L(e.message,e.options||{}),e.message_type==="warning"&&S(e.message,e.options||{}))},g=async()=>{if(!a.value){a.value=!0,o.value!==null&&(o.value(),o.value=null,u("Back online!")),await s.value.send(JSON.stringify({type:"frontend_client",token:c.token,client_id:k}));for(const n of t.reconnect)n()}},v=async n=>{a.value=!1,o.value===null&&(o.value=f("Lost connection to backend, trying to reconnect...",{color:"warning"})),setTimeout(i,5e3)},m=n=>{},i=()=>{const n="http://localhost:5001/api".replace("https://","wss://").replace("http://","ws://")+"/ws/connect";s.value=new WebSocket(n),s.value.addEventListener("open",g),s.value.addEventListener("close",v),s.value.addEventListener("message",p),s.value.addEventListener("error",m)},l=()=>{s.value.disconnect()},d=(n,e=null)=>{e in t||(t[e]=[]),t[e].push(n)},w=n=>{t.reconnect.push(n)};return b(()=>c.isAuthenticated,n=>{n?i():l()}),c.isAuthenticated&&i(),{isConnected:a,connect:i,disconnect:l,onmessage:d,onreconnect:w}});export{I as u};
