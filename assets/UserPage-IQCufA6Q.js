import{d as I,b as o,c as j,w as A,o as E,v as s,a7 as y,p as F,I as a,a8 as f,a9 as c,y as L,u as r,x as R,aa as v,a0 as w,Q}from"./index-Du_3Vesk.js";import{Q as U}from"./QForm-DvVOEjuU.js";import{Q as C}from"./QItem-DtTTb-ec.js";import{Q as D}from"./QList-C_17cm5H.js";import{u as O}from"./use-quasar-IjjsIl5B.js";import{u as T}from"./user-Q-Yu3pSj.js";import{u as $}from"./auth-dzuJufgy.js";import{a as P}from"./api-C-PlNVV_.js";import"./pinia-BXXl-SmG.js";import"./websocket-Cgz6NUB5.js";import"./utils-BH9nH3nv.js";import"./axios-CInKXjoT.js";import"./index-3fevySbJ.js";const se=I({__name:"UserPage",setup(z){const _=O(),t=T(),k=$(),b=o(null),N=o(null),V=o(""),n=o(""),g=o(""),d=o(t.email),m=o(t.firstName),i=o(t.lastName),S=o({}),x=j(async()=>b.value&&await b.value.validate());A(()=>k.isAuthenticated,()=>{d.value=t.email.value,m.value=t.firstName.value,i.value=t.lastName.value,S.value=t.apps.value});const p={name:[l=>!!l||"Required"],email:[l=>!!l||"E-mail is required",l=>/.+@.+\..+/.test(l)||"E-mail must be valid"],password:[l=>!!l||"Password is required",l=>l&&l.length>=6||"Password must be at least 6 characters"],matching:[l=>l===n.value||"Passwords not matching"]},q=async()=>{await P.post("/user/change_password",{password:V.value,new_password:n.value})&&(V.value="",n.value="",g.value="",N.value.reset(),_.notify({message:"Password changed",color:"positive"}))},B=async()=>{await b.value.validate();const l={};d.value!==t.email&&(l.email=d.value),m.value!==t.firstName&&(l.firstName=m.value),i.value!==t.lastName&&(l.lastName=i.value),Object.keys(l).length&&await P.post("/user/update",l)};return(l,e)=>(F(),E(y,{style:{"object-fit":"cover"}},{default:s(()=>[a(f,null,{default:s(()=>[c(" User Settings ("+L(r(t).name)+") ",1)]),_:1}),a(f,null,{default:s(()=>[a(D,null,{default:s(()=>[a(C,null,{default:s(()=>[a(y,{flat:""},{default:s(()=>[a(f,null,{default:s(()=>e[6]||(e[6]=[c(" Change User ")])),_:1}),a(f,null,{default:s(()=>[a(U,{ref_key:"formUser",ref:b},{default:s(()=>[a(v,{modelValue:r(d),"onUpdate:modelValue":e[0]||(e[0]=u=>w(d)?d.value=u:null),rules:p.email,dense:"",label:"email"},null,8,["modelValue","rules"]),a(v,{modelValue:r(m),"onUpdate:modelValue":e[1]||(e[1]=u=>w(m)?m.value=u:null),rules:p.name,dense:"",label:"First name"},null,8,["modelValue","rules"]),a(v,{modelValue:r(i),"onUpdate:modelValue":e[2]||(e[2]=u=>w(i)?i.value=u:null),rules:p.name,dense:"",label:"Last name"},null,8,["modelValue","rules"]),e[8]||(e[8]=R("br",null,null,-1)),a(Q,{color:"primary",disable:!r(x),onClick:B},{default:s(()=>e[7]||(e[7]=[c(" Confirm ")])),_:1},8,["disable"])]),_:1},512)]),_:1})]),_:1})]),_:1}),a(C,null,{default:s(()=>[a(y,{flat:""},{default:s(()=>[a(f,null,{default:s(()=>e[9]||(e[9]=[c(" Change Password ")])),_:1}),a(f,null,{default:s(()=>[a(U,{ref_key:"formPassword",ref:N,onSubmit:q},{default:s(()=>[a(v,{modelValue:r(V),"onUpdate:modelValue":e[3]||(e[3]=u=>w(V)?V.value=u:null),label:"Current password",type:"password",dense:""},null,8,["modelValue"]),a(v,{modelValue:r(n),"onUpdate:modelValue":e[4]||(e[4]=u=>w(n)?n.value=u:null),label:"New password",type:"password",rules:p.password,color:"success",dense:""},null,8,["modelValue","rules"]),a(v,{modelValue:r(g),"onUpdate:modelValue":e[5]||(e[5]=u=>w(g)?g.value=u:null),label:"Confirm new password",type:"password",rules:p.password.concat(p.matching),color:"success",dense:""},null,8,["modelValue","rules"]),a(Q,{color:"primary",type:"submit"},{default:s(()=>e[10]||(e[10]=[c(" Change password ")])),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{se as default};
